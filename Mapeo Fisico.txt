CREATE SCHEMA REVISTAS_DIGITALES;

USE REVISTAS_DIGITALES;

CREATE TABLE usuario (
    nombre VARCHAR(100) NOT NULL,
    clave VARCHAR(100) NOT NULL,
    foto LONGBLOB,
    hobbies TEXT,
    intereses TEXT,
    descripcion TEXT,
    rol VARCHAR(15) NOT NULL,
    CONSTRAINT pk_usuario PRIMARY KEY (nombre)
);

CREATE TABLE anuncio (
    id INT AUTO_INCREMENT PRIMARY KEY,
    anunciante VARCHAR(100) NOT NULL,
    fecha DATE NOT NULL,
    tipo VARCHAR(10) NOT NULL,
    vigencia VARCHAR(10) NOT NULL,
    texto TEXT,
    imagen LONGBLOB,
    video LONGBLOB,
    estado VARCHAR(10) NOT NULL,
    precio DECIMAL(10, 2),
    CONSTRAINT fk_anunciante FOREIGN KEY (anunciante) REFERENCES usuario(nombre)
);


CREATE TABLE carteraDigital (
    usuario VARCHAR(100) NOT NULL,
    saldo DECIMAL(10, 2) NOT NULL DEFAULT 0.0,
    CONSTRAINT pk_usuario PRIMARY KEY (usuario),
    CONSTRAINT fk_usuario FOREIGN KEY (usuario) REFERENCES usuario(nombre) ON DELETE CASCADE
);

CREATE TABLE tipoAnuncio (
    nombre VARCHAR(50) PRIMARY KEY,
    precio DECIMAL(10, 2) DEFAULT 50.00
);

INSERT INTO tipoAnuncio (nombre)
VALUES
    ('Txt'),
    ('Txt-Img'),
    ('Video');

CREATE TABLE tag (
    nombre VARCHAR(100) PRIMARY KEY
);

INSERT INTO tag (nombre) VALUES
('Tecnologia'),
('Deportes'),
('Ciencia'),
('Arte'),
('Historia'),
('Economia'),
('Politica'),
('Salud'),
('Literatura'),
('Entretenimiento'),
('Musica'),
('Cine'),
('Viajes'),
('Gastronomia'),
('Educacion'),
('Moda'),
('Cultura'),
('Medio Ambiente'),
('Sociologia'),
('Psicologia');

CREATE TABLE revista (
    nombre VARCHAR(100) NOT NULL,
    editor VARCHAR(100) NOT NULL,
    bloqueo VARCHAR(5),
    fecha DATE,
    costo DECIMAL(10,2),
    descripcion TEXT,
    categoria VARCHAR(50),
    CONSTRAINT pk_revista PRIMARY KEY (nombre),
    CONSTRAINT fk_revista_editor FOREIGN KEY (editor) REFERENCES usuario(nombre)
);

CREATE TABLE revista_tag (
    revista_nombre VARCHAR(100) NOT NULL,
    tag_nombre VARCHAR(100) NOT NULL,
    CONSTRAINT pk_revista_tag PRIMARY KEY (revista_nombre, tag_nombre),
    CONSTRAINT fk_revista_tag_revista FOREIGN KEY (revista_nombre) REFERENCES revista(nombre),
    CONSTRAINT fk_revista_tag_tag FOREIGN KEY (tag_nombre) REFERENCES tag(nombre)
);

CREATE TABLE publicacion (
    version INT NOT NULL AUTO_INCREMENT,
    revista VARCHAR(100) NOT NULL,
    pdf LONGBLOB,
    PRIMARY KEY (version),
    CONSTRAINT fk_publicacion_revista
        FOREIGN KEY (revista) REFERENCES revista(nombre)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);




